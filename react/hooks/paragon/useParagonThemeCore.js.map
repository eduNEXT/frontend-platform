{"version":3,"file":"useParagonThemeCore.js","names":["useEffect","useState","logError","logInfo","fallbackThemeUrl","removeExistingLinks","useParagonThemeCore","_ref","themeCore","onLoad","isParagonThemeCoreLoaded","setIsParagonThemeCoreLoaded","isBrandThemeCoreLoaded","setIsBrandThemeCoreLoaded","urls","getParagonThemeCoreLink","document","head","querySelector","existingCoreThemeLink","default","brandCoreLink","brandOverride","getExistingCoreThemeLinks","isBrandOverride","coreThemeLinkSelector","querySelectorAll","createCoreThemeLink","url","isFallbackThemeUrl","arguments","length","undefined","coreThemeLink","createElement","href","rel","dataset","brandThemeCore","paragonThemeCore","onload","onerror","otherExistingLinks","paragonThemeAccessor","themeUrls","PARAGON_THEME","core","coreThemeFallbackUrl","fileName","foundParagonThemeCoreLink","insertAdjacentElement","paragonCoreThemeLink","brandCoreThemeLink","removeAttribute"],"sources":["../../../../src/react/hooks/paragon/useParagonThemeCore.js"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport { logError, logInfo } from '../../../logging';\nimport { fallbackThemeUrl, removeExistingLinks } from './utils';\n\n/**\n * Adds/updates a `<link>` element in the HTML document to load the core application theme CSS.\n *\n * @memberof module:React\n *\n * @param {object} args\n * @param {object} args.themeCore Object representing the core Paragon theme CSS.\n * @param {string} args.onLoad A callback function called when the core theme CSS is loaded.\n */\nconst useParagonThemeCore = ({\n  themeCore,\n  onLoad,\n}) => {\n  const [isParagonThemeCoreLoaded, setIsParagonThemeCoreLoaded] = useState(false);\n  const [isBrandThemeCoreLoaded, setIsBrandThemeCoreLoaded] = useState(false);\n\n  useEffect(() => {\n    // Call `onLoad` once both the paragon and brand theme core are loaded.\n    if (isParagonThemeCoreLoaded && isBrandThemeCoreLoaded) {\n      onLoad();\n    }\n  }, [isParagonThemeCoreLoaded, isBrandThemeCoreLoaded, onLoad]);\n\n  useEffect(() => {\n    // If there is no config for the core theme url, do nothing.\n    if (!themeCore?.urls) {\n      setIsParagonThemeCoreLoaded(true);\n      setIsBrandThemeCoreLoaded(true);\n      return;\n    }\n    const getParagonThemeCoreLink = () => document.head.querySelector('link[data-paragon-theme-core=\"true\"]');\n    const existingCoreThemeLink = document.head.querySelector(`link[href='${themeCore.urls.default}']`);\n    const brandCoreLink = document.head.querySelector(`link[href='${themeCore.urls.brandOverride}']`);\n    if (!existingCoreThemeLink) {\n      const getExistingCoreThemeLinks = (isBrandOverride) => {\n        const coreThemeLinkSelector = `link[data-${isBrandOverride ? 'brand' : 'paragon'}-theme-core=\"true\"]`;\n        return document.head.querySelectorAll(coreThemeLinkSelector);\n      };\n      const createCoreThemeLink = (\n        url,\n        {\n          isFallbackThemeUrl = false,\n          isBrandOverride = false,\n        } = {},\n      ) => {\n        let coreThemeLink = document.createElement('link');\n        coreThemeLink.href = url;\n        coreThemeLink.rel = 'stylesheet';\n        if (isBrandOverride) {\n          coreThemeLink.dataset.brandThemeCore = true;\n        } else {\n          coreThemeLink.dataset.paragonThemeCore = true;\n        }\n        coreThemeLink.onload = () => {\n          if (isBrandOverride) {\n            setIsBrandThemeCoreLoaded(true);\n          } else {\n            setIsParagonThemeCoreLoaded(true);\n          }\n        };\n        coreThemeLink.onerror = () => {\n          logError(`Failed to load core theme CSS from ${url}`);\n          if (isFallbackThemeUrl) {\n            logError(`Could not load core theme CSS from ${url} or fallback URL. Aborting.`);\n            if (isBrandOverride) {\n              setIsBrandThemeCoreLoaded(true);\n            } else {\n              setIsParagonThemeCoreLoaded(true);\n            }\n            const otherExistingLinks = getExistingCoreThemeLinks(isBrandOverride);\n            removeExistingLinks(otherExistingLinks);\n            return;\n          }\n          const paragonThemeAccessor = isBrandOverride ? 'brand' : 'paragon';\n          const themeUrls = PARAGON_THEME?.[paragonThemeAccessor]?.themeUrls ?? {};\n          if (themeUrls.core) {\n            const coreThemeFallbackUrl = fallbackThemeUrl(themeUrls.core.fileName);\n            logInfo(`Falling back to locally installed core theme CSS: ${coreThemeFallbackUrl}`);\n            coreThemeLink = createCoreThemeLink(coreThemeFallbackUrl, { isFallbackThemeUrl: true, isBrandOverride });\n            const otherExistingLinks = getExistingCoreThemeLinks(isBrandOverride);\n            removeExistingLinks(otherExistingLinks);\n            const foundParagonThemeCoreLink = getParagonThemeCoreLink();\n            if (foundParagonThemeCoreLink) {\n              foundParagonThemeCoreLink.insertAdjacentElement(\n                'afterend',\n                coreThemeLink,\n              );\n            } else {\n              document.head.insertAdjacentElement(\n                'afterbegin',\n                coreThemeLink,\n              );\n            }\n          } else {\n            logError(`Failed to load core theme CSS from ${url} or fallback URL. Aborting.`);\n          }\n        };\n        return coreThemeLink;\n      };\n\n      const paragonCoreThemeLink = createCoreThemeLink(themeCore.urls.default);\n      document.head.insertAdjacentElement(\n        'afterbegin',\n        paragonCoreThemeLink,\n      );\n\n      if (themeCore.urls.brandOverride) {\n        const brandCoreThemeLink = createCoreThemeLink(themeCore.urls.brandOverride, { isBrandOverride: true });\n        const foundParagonThemeCoreLink = getParagonThemeCoreLink();\n        if (foundParagonThemeCoreLink) {\n          foundParagonThemeCoreLink.insertAdjacentElement(\n            'afterend',\n            brandCoreThemeLink,\n          );\n        } else {\n          document.head.insertAdjacentElement(\n            'afterbegin',\n            brandCoreThemeLink,\n          );\n        }\n      } else {\n        setIsBrandThemeCoreLoaded(true);\n      }\n    } else {\n      existingCoreThemeLink.rel = 'stylesheet';\n      existingCoreThemeLink.removeAttribute('as');\n      existingCoreThemeLink.dataset.paragonThemeCore = true;\n      if (brandCoreLink) {\n        brandCoreLink.rel = 'stylesheet';\n        brandCoreLink.removeAttribute('as');\n        brandCoreLink.dataset.brandThemeCore = true;\n      }\n      setIsParagonThemeCoreLoaded(true);\n      setIsBrandThemeCoreLoaded(true);\n    }\n  }, [themeCore?.urls, onLoad]);\n};\n\nexport default useParagonThemeCore;\n"],"mappings":"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","ignoreList":[]}