{"version":3,"file":"useParagonThemeCore.js","names":["useEffect","useState","logError","logInfo","fallbackThemeUrl","removeExistingLinks","useParagonThemeCore","_ref","themeCore","onComplete","_useState","_useState2","_slicedToArray","isParagonThemeCoreComplete","setIsParagonThemeCoreComplete","_useState3","_useState4","isBrandThemeCoreComplete","setIsBrandThemeCoreComplete","urls","existingCoreThemeLink","document","head","querySelector","concat","brandCoreLink","brandOverride","rel","removeAttribute","dataset","paragonThemeCore","brandThemeCore","getParagonThemeCoreLink","getExistingCoreThemeLinks","isBrandOverride","coreThemeLinkSelector","querySelectorAll","createCoreThemeLink","url","_ref2","arguments","length","undefined","_ref2$isFallbackTheme","isFallbackThemeUrl","_ref2$isBrandOverride","coreThemeLink","createElement","href","onload","onerror","_PARAGON_THEME$parago","_PARAGON_THEME","otherExistingLinks","paragonThemeAccessor","core","PARAGON_THEME","themeUrls","coreThemeFallbackUrl","fileName","foundParagonThemeCoreLink","insertAdjacentElement","paragonCoreThemeLink","brandCoreThemeLink"],"sources":["../../../../src/react/hooks/paragon/useParagonThemeCore.js"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport { logError, logInfo } from '../../../logging';\nimport { fallbackThemeUrl, removeExistingLinks } from './utils';\n\n/**\n * Custom React hook that manages the loading and updating of the core Paragon theme CSS and the brand override\n * theme CSS. It ensures that the core theme CSS (both default and brand override) is added to the document\n * `<head>` as `<link>` elements.\n *\n * The function logs and handles fallback logic in case the core theme fails to load.\n *\n * @memberof module:React\n *\n * @param {Object} args - The arguments object containing theme and callback information.\n * @param {Object} args.themeCore - The core theme configuration.\n * @param {string} args.themeCore.urls.default - The URL to the default core theme CSS.\n * @param {string} [args.themeCore.urls.brandOverride] - The URL to the brand override theme CSS (optional).\n * @param {Function} args.onComplete - A callback function that is called once both the core Paragon (default)\n * theme and brand override theme (if provided) are complete.\n */\nconst useParagonThemeCore = ({\n  themeCore,\n  onComplete,\n}) => {\n  const [isParagonThemeCoreComplete, setIsParagonThemeCoreComplete] = useState(false);\n  const [isBrandThemeCoreComplete, setIsBrandThemeCoreComplete] = useState(false);\n\n  useEffect(() => {\n    // Call `onComplete` once both the paragon and brand theme core are complete.\n    if (isParagonThemeCoreComplete && isBrandThemeCoreComplete) {\n      onComplete();\n    }\n  }, [isParagonThemeCoreComplete, isBrandThemeCoreComplete, onComplete]);\n\n  useEffect(() => {\n    // If there is no config for the core theme url, do nothing.\n    if (!themeCore?.urls) {\n      setIsParagonThemeCoreComplete(true);\n      setIsBrandThemeCoreComplete(true);\n      return;\n    }\n\n    const existingCoreThemeLink = document.head.querySelector(`link[href='${themeCore.urls.default}']`);\n    const brandCoreLink = document.head.querySelector(`link[href='${themeCore.urls.brandOverride}']`);\n\n    if (existingCoreThemeLink) {\n      existingCoreThemeLink.rel = 'stylesheet';\n      existingCoreThemeLink.removeAttribute('as');\n      existingCoreThemeLink.dataset.paragonThemeCore = true;\n      if (brandCoreLink) {\n        brandCoreLink.rel = 'stylesheet';\n        brandCoreLink.removeAttribute('as');\n        brandCoreLink.dataset.brandThemeCore = true;\n      }\n      setIsParagonThemeCoreComplete(true);\n      setIsBrandThemeCoreComplete(true);\n      return;\n    }\n\n    const getParagonThemeCoreLink = () => document.head.querySelector('link[data-paragon-theme-core=\"true\"]');\n    const getExistingCoreThemeLinks = (isBrandOverride) => {\n      const coreThemeLinkSelector = `link[data-${isBrandOverride ? 'brand' : 'paragon'}-theme-core=\"true\"]`;\n      return document.head.querySelectorAll(coreThemeLinkSelector);\n    };\n\n    const createCoreThemeLink = (\n      url,\n      {\n        isFallbackThemeUrl = false,\n        isBrandOverride = false,\n      } = {},\n    ) => {\n      let coreThemeLink = document.createElement('link');\n      coreThemeLink.href = url;\n      coreThemeLink.rel = 'stylesheet';\n      if (isBrandOverride) {\n        coreThemeLink.dataset.brandThemeCore = true;\n      } else {\n        coreThemeLink.dataset.paragonThemeCore = true;\n      }\n      coreThemeLink.onload = () => {\n        if (isBrandOverride) {\n          setIsBrandThemeCoreComplete(true);\n        } else {\n          setIsParagonThemeCoreComplete(true);\n        }\n      };\n      coreThemeLink.onerror = () => {\n        if (isFallbackThemeUrl) {\n          logError('Could not load core theme fallback URL. Aborting.');\n          if (isBrandOverride) {\n            setIsBrandThemeCoreComplete(true);\n          } else {\n            setIsParagonThemeCoreComplete(true);\n          }\n          const otherExistingLinks = getExistingCoreThemeLinks(isBrandOverride);\n          removeExistingLinks(otherExistingLinks);\n          return;\n        }\n        const paragonThemeAccessor = isBrandOverride ? 'brand' : 'paragon';\n        const core = PARAGON_THEME?.[paragonThemeAccessor]?.themeUrls?.core ?? null;\n        if (core) {\n          const coreThemeFallbackUrl = fallbackThemeUrl(core.fileName);\n          logInfo(`Could not load core theme CSS from ${url}. Falling back to locally installed core theme CSS: ${coreThemeFallbackUrl}`);\n          coreThemeLink = createCoreThemeLink(coreThemeFallbackUrl, { isFallbackThemeUrl: true, isBrandOverride });\n          const otherExistingLinks = getExistingCoreThemeLinks(isBrandOverride);\n          removeExistingLinks(otherExistingLinks);\n          const foundParagonThemeCoreLink = getParagonThemeCoreLink();\n          if (foundParagonThemeCoreLink) {\n            foundParagonThemeCoreLink.insertAdjacentElement(\n              'afterend',\n              coreThemeLink,\n            );\n          } else {\n            document.head.insertAdjacentElement(\n              'afterbegin',\n              coreThemeLink,\n            );\n          }\n        } else {\n          logError(`Failed to load core theme CSS from ${url} or fallback URL. Aborting.`);\n        }\n      };\n      return coreThemeLink;\n    };\n\n    const paragonCoreThemeLink = createCoreThemeLink(themeCore.urls.default);\n    document.head.insertAdjacentElement(\n      'afterbegin',\n      paragonCoreThemeLink,\n    );\n\n    if (themeCore.urls.brandOverride) {\n      const brandCoreThemeLink = createCoreThemeLink(themeCore.urls.brandOverride, { isBrandOverride: true });\n      const foundParagonThemeCoreLink = getParagonThemeCoreLink();\n      if (foundParagonThemeCoreLink) {\n        foundParagonThemeCoreLink.insertAdjacentElement(\n          'afterend',\n          brandCoreThemeLink,\n        );\n      } else {\n        document.head.insertAdjacentElement(\n          'afterbegin',\n          brandCoreThemeLink,\n        );\n      }\n    } else {\n      setIsBrandThemeCoreComplete(true);\n    }\n  }, [themeCore?.urls, onComplete]);\n};\n\nexport default useParagonThemeCore;\n"],"mappings":"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","ignoreList":[]}